<!-- #include virtual = "/myoffice/common/db_connect.inc" -->

<!-- #include virtual = "/myoffice/inc/head.html" -->

<%
Session.CodePage = "65001" : Response.CharSet = "utf-8"
%>
<div class="signupContainer">
	<div class="signupContent">
		<form name="reg_frm" id="reg_frm" method="post">
			<input type="hidden" name="work_user" value="<%=session("userid")%>">
			<input type="hidden" name="center" value="0000">
			<input type="hidden" name="wallet" id="wallet" value="">
			<input type="hidden" name="wallet_code" id="wallet_code" value="">
			<input type="hidden" name="user_kind" value="2101" />

			<div class="section">
				<h3 class="sectionTitle">Upline Information</h3>
				<div class="innerBox">
					<div class="tableBox">
						<label for="recomm_in">
							<div class="labelInnerBox">
								<span class="inputTitle">Enroller ID</span>
								<button type="button" id="btn_recomm_chk" class="inputBtn" onclick="upline_chk('R');">Check</button>
							</div>
						</label>
						<input type="text" name="recomm_in" id="recomm_in" placeholder="Enter Enroller ID"
							   check="T" check_type="length" check_length="0" check_key=""
							   title="You have to check your Enroller information."
							   maxLength="30" value="<%=r_id%>">
						<span class="focus-input100"></span>
					</div>
					<div class="tableBox">
						<label>
							<div class="labelInnerBox">
								<span class="inputTitle">Enroller Name</span>
							</div>
						</label>
						<span id="exp_recomm" class="hiddenInputName"></span>
						<input type="hidden" name="recomm_id" id="recomm_id"  placeholder="Enter Enroller ID"
							   check="T" check_type="length" check_length="0" check_key=""
							   title="Please check your Enroller information.">
					</div>
					<div class="tableBox" style="background:#252525;">
						<p class="infoBox">You cannot change your upline information (Enroller ID) after signup.<br>Please be sure to check your correct upline information.</p>
					</div>
				</div>
			</div>
			<div class="section">
				<h3 class="sectionTitle">New user information</h3>
				<div class="innerBox">
					<div class="tableBox">
						<label for="country">
							<div class="labelInnerBox">
								<span class="inputTitle">Country</span>
							</div>
						</label>
						<select name="country" id="country"
								check="T" check_type="length" check_length="0" check_key=""
								title="Please select the country field.">
							<%
							sql =		"select	country, country_name	"
							sql = sql & "  from	country					"
							sql = sql & " where	isUSE = '1'				"
							sql = sql & " order by country				"
							Set rs_country = DBConn.Execute(sql)

							Do While Not rs_country.Eof
								Response.Write "<option value='" & rs_country("country") & "'>" & rs_country("country_name") & "</option>"
								rs_country.MoveNext
							Loop
							rs_country.Close
							%>
						</select>
						<span class="focus-input100"></span>
					</div>
					<div class="tableBox">
						<label for="firstname">
							<div class="labelInnerBox">
								<span class="inputTitle">First Name</span>
							</div>
						</label>
						<input type="text" name="firstname" id="firstname" placeholder="Enter First Name"
							   check="T" check_type="length" check_length="0" check_key=""
							   title="Please fill in the firstname field."
							   value="<%=firstname%>">
						<span class="focus-input100"></span>
					</div>
					<div class="tableBox">
						<label for="lastname">
							<div class="labelInnerBox">
								<span class="inputTitle">Last Name</span>
							</div>
						</label>
						<input type="text" name="lastname" id="lastname" placeholder="Enter Last Name"
							   check="T" check_type="length" check_length="0" check_key=""
							   title="Please fill in the lastname field."
							   value="<%=lastname%>">
						<span class="focus-input100"></span>
					</div>
					<!--
					<div class="tableBox">
						<label for="birth_y birth_m birth_d">
							<div class="labelInnerBox">
								<span class="inputTitle">Birthday</span>
							</div>
						</label>
						<select name="birth_y" id="birth_y"
									check="T" check_type="length" check_length="0" check_key=""
									title="Please fill in the birthday field.">
							<option value="">Year</option>
							<%
							For yy = CInt(year(date)) - 10 To CInt(Year(date)) - 100 Step -1
								Response.Write "<option value='" & yy & "'>" & yy & "</option>"
							Next
							%>
						</select>
						<span class="focus-input100"></span>
						<select name="birth_m" id="birth_m"
								check="T" check_type="length" check_length="0" check_key=""
								title="Please fill in the birthday field.">
							<option value="">Month</option>
							<%
							For mm = 1 To 12
								Response.Write "<option value='" & Right("0"&mm,2) & "'>" & Right("0"&mm,2) & "</option>"
							Next
							%>
						</select>
						<span class="focus-input100"></span>
						<select name="birth_d" id="birth_d"
								check="T" check_type="length" check_length="0" check_key=""
								title="Please fill in the birthday field.">
							<option value="">Day</option>
							<%
							For dd = 1 To 31
								Response.Write "<option value='" & Right("0"&dd,2) & "'>" & Right("0"&dd,2) & "</option>"
							Next
							%>
						</select>
						<span class="focus-input100"></span>
					</div>
					-->
					<div class="tableBox">
						<label for="exp_id">
							<div class="labelInnerBox">
								<span class="inputTitle">Login ID</span>
								<button type="button" id="id_chk_btn" class="inputBtn" onclick="login_id_chk();">Check</button>
								<button type="button" id="id_chk_reset" class="inputBtn reset" onclick="login_id_reset();" style="display:none;">Reset</button>
							</div>
						</label>
						<input type="text" name="exp_id" id="exp_id" placeholder="Enter Login ID"
							   check="T" check_type="length" check_length="0" check_key=""
							   title="Please fill in the Login ID field."
							   maxLength="12">
						<span class="focus-input100"></span>
						<input	type="hidden" name="dupl_chk" id="dupl_chk"
								check="T" check_type="value" check_length="0" check_key="T"
								title="Please fill in the Login ID field.">
					</div>
					<div class="tableBox">
						<label for="passwd">
							<div class="labelInnerBox">
								<span class="inputTitle">Password</span>
							</div>
						</label>
						<input type="password" name="passwd" id="passwd" placeholder="Enter Password"
							   check="T" check_type="length" check_length="3" check_key=""
							   title="Please fill in the password field more than 4 characters."
							   maxLength="30">
						<span class="focus-input100"></span>
					</div>
					<div class="tableBox">
						<label for="passwd_re">
							<div class="labelInnerBox">
								<span class="inputTitle">Confirm Password</span>
							</div>
						</label>
						<input type="password" name="passwd_re" id="passwd_re" placeholder="Enter Confirm Password"
							   check="T" check_type="length" check_length="3" check_key=""
							   title="Please check your password."
							   maxLength="30">
						<span class="focus-input100"></span>
					</div>
					<%
					sql = "select code, code_name from basic_code where isuse = '1' and code_kind = '61'	"
					Set w_rs = DBConn.Execute(sql)

					If Not w_rs.EOF Then
						temp_names = ""
						Do While Not w_rs.EOF
							w_code		= w_rs("code")
							w_code_name = UCase(w_rs("code_name"))

							Response.Write "<div class=""tableBox"">"
							Response.Write "	<label for=""wallet_"&w_code&""">"
							Response.Write "		<div class=""labelInnerBox"">"
							Response.Write "			<span class=""inputTitle"">Wallet Address "&w_code_name&"</span>"
							Response.Write "			<button type=""button"" id=""btn_"&w_code&""" class=""inputBtn"" onclick=""wallet_chk('"&w_code&"');"">Check</button>"
							Response.Write "			<button type=""button"" id=""btn_"&w_code&"_reset"" class=""inputBtn reset"" onclick=""wallet_reset('"&w_code&"');"" style=""display:none;"">Reset</button>"
							Response.Write "		</div>"
							Response.Write "	</label>"
							Response.Write "	<input type=""text"" name=""wallet_"&w_code&""" id=""wallet_"&w_code&""" placeholder=""Enter Wallet Address"""
							Response.Write "		   check=""F"" check_type=""length"" check_length=""0"" check_key="""""
							Response.Write "		   title=""Please fill in the wallet address field."">"
							Response.Write "	<span class=""focus-input100""></span>"
							Response.Write "	<input type=""hidden"" id=""chk_wallet_"&w_code&""" />"
							Response.Write "	<input type=""hidden"" name=""code_wallet_"&w_code&""" id=""code_wallet_"&w_code&""" value=""" & w_code & """ />"
							Response.Write "</div>"

							temp_names = temp_names & "wallet_" & w_code & ","
							w_rs.Movenext
						Loop
						wallet_id = Left(temp_names, Len(temp_names)-1)

						arrWallet = Split(wallet_id, ",")
					End If
					%>
					<!--
					<div class="tableBox">
						<label for="btc">
							<div class="labelInnerBox">
								<span class="inputTitle">Wallet Address BTC</span>
							</div>
						</label>
						<input type="text" name="wallet_btc" id="wallet_btc" placeholder="Enter Wallet Address"
							   check="F" check_type="length" check_length="0" check_key=""
							   title="Please fill in the wallet address field.">
						<span class="focus-input100"></span>
					</div>
					<div class="tableBox">
						<label for="eth">
							<div class="labelInnerBox">
								<span class="inputTitle">Wallet Address ETH</span>
							</div>
						</label>
						<input type="text" name="wallet_eth" id="wallet_eth" placeholder="Enter Wallet Address"
							   check="F" check_type="length" check_length="0" check_key=""
							   title="Please fill in the wallet address field.">
						<span class="focus-input100"></span>
					</div>
					<div class="tableBox">
						<label for="aac">
							<div class="labelInnerBox">
								<span class="inputTitle">Wallet Address AAC</span>
							</div>
						</label>
						<input type="text" name="wallet_aac" id="wallet_aac" placeholder="Enter Wallet Address"
							   check="F" check_type="length" check_length="0" check_key=""
							   title="Please fill in the wallet address field.">
						<span class="focus-input100"></span>
					</div>
					-->
					<div class="tableBox">
						<label for="mobile">
							<div class="labelInnerBox">
								<span class="inputTitle">Mobile Phone</span>
							</div>
						</label>
						<input type="tel" name="mobile" id="mobile" placeholder="Enter Mobile Phone"
							   check="T" check_type="length" check_length="0" check_key=""
							   title="Please fill in the mobile phone field."
							   maxLength="20">
						<span class="focus-input100"></span>
					</div>
					<div class="tableBox">
						<label for="email">
							<div class="labelInnerBox">
								<span class="inputTitle">E-Mail</span>
							</div>
						</label>
						<input type="text" name="email" id="email" placeholder="Enter E-Mail"
							   check="T" check_type="length" check_length="0" check_key=""
							   title="Please fill in the E-Mail field."
							   maxLength="100">
						<span class="focus-input100"></span>
					</div>
				</div>
			</div>
			<div class="section">
				<div class="innerBox btnWrap">
					<button type="button" class="btnDefault" style="background:#8666b2;" id="btnSend">Signup</button>
					<button type="button" class="btnDefault" style="background:#313133;" onClick="location.href='/myoffice/index.html';">Cancel</button>
				</div>
			</div>
		</form>
	</div>
</div>

<!-- #include virtual = "/myoffice/inc/footer.html" -->

<script>
$(document).ready(function() {
	$('#exp_id').keyup(function() {
		$(this).val( $(this).val().replace( /[ㄱ-ㅎ| |ㅏ-ㅣ|가-힣]/g, '' ) );
	});
});

$("#btnSend").on("click", function(){
	var proc_ok = "T";

	var wallet		= "";
	var wallet_code	= "";
	var $wallet		= $("#wallet");
	var $wallet_code= $("#wallet_code");


	<%
	temp_if = ""
	For i = 0 To UBound(arrWallet)
		Response.Write "var $" & arrWallet(i) & "= $(""#" & arrWallet(i) & """);"
		Response.Write "var $code_" & arrWallet(i) & "= $(""#code_" & arrWallet(i) & """);"
		temp_if = temp_if & "$" & arrWallet(i) & ".val() == """" &&"
	Next
	script_if = Left(temp_if, Len(temp_if)-2)
	%>

	<%
	For i = 0 To UBound(arrWallet)
		Response.Write "if ($" & arrWallet(i) & ".val()){"
		Response.Write "	if ($(""#chk_" & arrWallet(i) & """).val()!=""T""){"
		Response.Write "		alert(""Please fill in the wallet address field."");"
		Response.Write "		$" & arrWallet(i) & ".focus();"
		Response.Write "		return false;"
		Response.Write "	}"
		Response.Write "		wallet += $" &arrWallet(i) & ".val() + "","";"
		Response.Write "		wallet_code += $code_" &arrWallet(i) & ".val() + "","";"
		Response.Write "}"
	Next
	%>
	$wallet.val("");
	$wallet.val(wallet);
	$wallet_code.val("");
	$wallet_code.val(wallet_code);

	if (<%=script_if%>){
		alert("Must input at least one wallet account.");
		$<%=arrWallet(0)%>.focus();
		return false;
	}


	if (!$("#reg_frm").validation()){
		proc_ok = "F";
		return false;
	}

	if(validateEmail($("#email").val()) != true){
		alert("Please check your E-Mail.");
		$("#email").focus();
		return false
	}

	if ($("#passwd").val() != $("#passwd_re").val()) {
		alert("Please check your password.");
		$("#passwd_re").focus();
		proc_ok = "F";
		return false;
	}

	if (proc_ok == "T")	{
		ajaxSendSignup();
	}
});

function ajaxSendSignup(){
	var url = "/myoffice/common/signup_proc.html";
	var data = $("#reg_frm").serializeObject();

	$.ajax({
		url : url,
		global :false,
		contentType : "application/x-www-form-urlencoded; charset=euc-kr",
		type : "POST",
		data : data,
		dataType: 'text',
		crossDomain: true,
		async:false,
		success:function(rtnData){
			var arrItem = rtnData.split("|");
			var rtnState= arrItem[0];
			var rtnMsg 	= arrItem[1].replace(/\\n/g, '\n');
			var	rtnUrl 	= arrItem[2];

			if (rtnState == "SUCCESS") {
				alert(rtnMsg);
				location.href = rtnUrl;
			} else {
				alert(rtnMsg);
			}
		},
		error:function(reponse,textStatus,errorThrown){
			alert("Sorry!!! Some errors are occurred.\n\nPlease try again later.\n\nThank you.");
		},
		beforeSend:function(){
		}
	});
}

function login_id_chk() {
	var $id_chk_btn		= $("#id_chk_btn");
	var $id_chk_reset	= $("#id_chk_reset");
	var $exp_id			= $("#exp_id");
	var $dupl_chk		= $("#dupl_chk");
	var $exp_id			= $("#exp_id");

	if ($("#exp_id").val().length < 4) {
		alert("LOGIN ID have to be more than 4 characters");
		$("#exp_id").focus();
	} else {
		var ajax_url = "/myoffice/common/duplication_chk.html?check_val=" + $exp_id.val();
		$.ajax(ajax_url, {
			success:function(data) {

				arrResult = data.split("|");

				if (arrResult[0] == "SUCCESS") {
					if(confirm(arrResult[1].replace(/\\n/g, '\n'))) {
						$id_chk_btn.hide();
						$id_chk_reset.show();
						$exp_id.attr("readonly", true);
						$dupl_chk.val("T");
					} else {
						$id_chk_btn.show();
						$exp_id.removeAttr("readonly");
						$dupl_chk.val("");
						$exp_id.val("");
					}
					return;
				} else {
					alert(arrResult[1].replace(/\\n/g, '\n'));
					$id_chk_btn.show();
					$exp_id.removeAttr("readonly");
					$dupl_chk.val("");
					$exp_id.val("");
					return;
				}
			}
		});
	}
}

function login_id_reset() {

	var $id_chk_btn		= $("#id_chk_btn");
	var $id_chk_reset	= $("#id_chk_reset");
	var $exp_id			= $("#exp_id");
	var $dupl_chk		= $("#dupl_chk");
	var $exp_id			= $("#exp_id");

	$id_chk_btn.show();
	$id_chk_reset.hide();
	$exp_id.removeAttr("readonly");
	$exp_id.focus();
	$dupl_chk.val("");
}

function upline_chk(fKIND) {
	if (fKIND == "P") {
		var check_val = $("#parents_in").val();
	} else if (fKIND == "R") {
		var check_val = $("#recomm_in").val();
	}

	if (check_val == "") {
		alert("You have to input exact your sponsor information.");
		if		(fKIND == "P") {$("#parents_in").focus();}
		else if (fKIND == "R") {$("#recomm_in").focus(); }
	} else {
		var ajax_url = "/myoffice/common/sponsor_chk.html?check_kind=" + fKIND + "&check_val=" + check_val;

		$.ajax(ajax_url, {
			success:function(data) {

				arrResult = data.split("|");

				if (arrResult[0] == "SUCCESS") {
//					alert(arrResult[1].replace(/\\n/g, '\n'));
					if (fKIND == "R"){
						objName = "recomm";
					} else if (fKIND == "P") {
						objName = "parents";
					}
					$("#" + objName + "_id").val(arrResult[2]);
					$("#exp_" + objName).text(arrResult[3]);
				} else {
					if (fKIND == "R"){
						objName = "recomm";
					} else if (fKIND == "P") {
						objName = "parents";
					}
					$("#exp_" + objName).text(arrResult[1]);
					return;
				}
			}
		});
	}

}

function wallet_chk(fKIND){
	var $wallet_addr = $("#wallet_"+fKIND);
	var	$wallet_kind = $("#code_wallet_"+fKIND);
	var $btn		 = $("#btn_"+fKIND);
	var $btn_reset	 = $("#btn_"+fKIND+"_reset");
	var $chk_wallet	 = $("#chk_wallet_"+fKIND);

	if($wallet_addr.val() == ""){
		alert("Please enter your Eletronic wallet account address.");
		$wallet_addr.focus();
		return false;
	} else {
		var ajax_url = "/myoffice/common/wallet_chk.html?wallet_addr=" + $wallet_addr.val()+"&wallet_kind="+$wallet_kind.val();
		$.ajax(ajax_url, {
			success:function(data) {

				arrResult = data.split("|");

				if (arrResult[0] == "SUCCESS") {
					if(confirm(arrResult[1].replace(/\\n/g, '\n'))) {
						$btn.hide();
						$btn_reset.show();
						$wallet_addr.attr("readonly", true);
						$chk_wallet.val("T");
					} else {
						$btn.show();
						$btn_reset.hide();
						$wallet_addr.removeAttr("readonly");
						$chk_wallet.val("");
						$wallet_addr.val("");
					}
					return;
				} else {
					alert(arrResult[1].replace(/\\n/g, '\n'));
					$btn.show();
					$wallet_addr.removeAttr("readonly");
					$chk_wallet.val("");
					$wallet_addr.val("");
					return;
				}
			}
		});
	}
}

function wallet_reset(fKIND){

	var $wallet_addr = $("#wallet_"+fKIND);
	var	$wallet_kind = $("#code_wallet_"+fKIND);
	var $btn		 = $("#btn_"+fKIND);
	var $btn_reset	 = $("#btn_"+fKIND+"_reset");
	var $chk_wallet	 = $("#chk_wallet_"+fKIND);

	$btn.show();
	$btn_reset.hide();
	$wallet_addr.removeAttr("readonly");
	$wallet_addr.focus();
	$chk_wallet.val("");
}

jQuery.fn.validation = function(){
	var fn_chek = false;
	if(this[0].tagName && this[0].tagName.toUpperCase() == "FORM" ) {
		var obj = $(this).find(":input");
		$.each(obj, function(index, value){
			var field_check = $(value).attr("check");
			var field_type	= $(value).attr("check_type");
			var field_length= $(value).attr("check_length");
			var field_key	= $(value).attr("check_key");
			var	field_alert	= $(value).attr("title");
			var field_value	= $(value).val();
			if (field_check == "T") {
				if (value.type == "checkbox"){
					field_key = (field_key) ? Number(field_key) : 1;
					if ($("input:checkbox[name=" + value.name + "]:checked").length < field_key){
						alert(field_alert);
						$(value).focus();
						fn_chek = false;
						return false;
					}
				} else if (value.type == "radio"){
					if ($("input:radio[name=" + value.name + "]:checked").length < 1){
						alert(field_alert);
						$(value).focus();
						fn_chek = false;
						return false;
					}
				} else if (field_type == "length") {
					if (field_value.length <= Number(field_length))	{
						alert(field_alert);
						$(value).focus();
						fn_chek = false;
						return false;
					}
				} else if (field_type == "value") {
					if (field_value != field_key)
					{
						alert(field_alert);
						$(value).focus();
						fn_chek = false;
						return false;
					}
				}
			}
			fn_chek = true;
		});
		return fn_chek;
	}
}

jQuery.fn.serializeObject = function() {
	var obj = null;
	try {
		// this[0].tagName이 form tag일 경우
		if(this[0].tagName && this[0].tagName.toUpperCase() == "FORM" ) {
			var arr = this.serializeArray();
			if(arr){
				obj = {};
				jQuery.each(arr, function() {
					// obj의 key값은 arr의 name, obj의 value는 value값

					switch(this.name) {
						case "wallet":
						case "wallet_code":
							if (obj[this.name]){
								obj[this.name] += "," + this.value;
							}else{
								obj[this.name] = this.value;
							}
							break;
						default:
							obj[this.name] = this.value;
					}
				});
			}
		}
	}catch(e) {
		alert(e.message);
	}finally  {}

	return obj;
};
</script>