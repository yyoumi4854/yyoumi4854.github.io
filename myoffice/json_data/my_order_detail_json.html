<%@ CodePage="65001" Language="vbscript"%>
<!--#include virtual="/myoffice/common/common.inc"-->
<!--#include virtual="/myoffice/common/jsonObject.class.asp"-->
<%
order_no	= Request("order_no")


' where

' // where

	sql =		"select	a.order_no, a.order_type, b.seq, d.product_name, b.qty, b.amt,	"
	sql = sql & "		(b.qty * b.amt) as order_amt,									"
	sql = sql & "		Decode(c.r_kind,'4201','현장수령',songjang_no) as delivery_no	"
	sql = sql & "  from	order_head a, order_detail b, order_stock_master c, product d	"
	sql = sql & " where	a.order_no = b.order_no											"
	sql = sql & "   and	a.order_no = c.order_no(+)										"
	sql = sql & "   and	b.product_cd = d.product_cd										"
	sql = sql & "   and	a.order_no = '" & order_no & "'									"
	sql = sql & " order by b.seq														"

	Set rs = Server.CreateObject("ADODB.RecordSet")
	rs.cursortype = 3
	rs.Open sql, DBConn

    Set JSONParse = New JSONobject
	Set JSONarr = New JSONarray

    While Not rs.EOF

		order_no	= rs("order_no")
		deli_no		= rs("delivery_no")
		qty			= CCur(rs("qty"))
		amt			= CCur(rs("amt"))
		order_amt	= CCur(rs("order_amt"))

		If rs("order_type") = "2" Or rs("order_type") = "4" Then
			qty			= -1 * qty
			amt			= -1 * amt
			order_amt	= -1 * order_amt
		End If

		If rs("order_type") = "1" Then
			If deli_no <> "현장수령" Then
				deli_no = Replace(deli_no,"-","")
			End If
		Else
			deli_no	= ""
		End If

		Set JSON = New JSONobject

		JSON.Add "order_no",		order_no
		JSON.Add "seq",				rs("seq")
		JSON.Add "product_name",	rs("product_name")
		JSON.Add "qty",				FormatNumber(qty, 0)
		JSON.Add "amt",				FormatNumber(amt, 0)
		JSON.Add "order_amt",		FormatNumber(order_amt, 0)

		JSONarr.Push JSON
	    rs.MoveNext
    Wend

	JSONParse.Add "list" ,JSONarr
	JSONParse.Write()

rs.Close		: Set rs = Nothing
DBConn.Close	: Set DBConn = Nothing
%>