<%@ CodePage="65001" Language="vbscript"%>
<!-- #include virtual = "/myoffice/common/common.inc" -->

<!-- #include virtual = "/myoffice/inc/head.html" -->

<!-- #include virtual = "/myoffice/inc/header.html" -->

<!-- #include virtual = "/myoffice/inc/nav.html" -->
<%
Call Check_Login(fURL)

kind	= Request("kind")	: If kind = "" Then kind = "recomm"
id		= Request("id")		: If id = "" Then id = Session("login_id")

If kind = "recomm" Then
	r_id = id
ElseIf kind = "parents" Then
	p_id = id
Else
	r_id = ""
	p_id = ""
End If
%>
<div id="container">
	<div class="contentHeader">
		<h3 class="contentTitle"><i class="fa fa-th-large" aria-hidden="true"></i> Signup</h3>
	</div>
	<div class="content">
		<form name="reg_frm" id="reg_frm" method="post">
		<input type="hidden" name="work_user" value="<%=session("userid")%>">
		<input type="hidden" name="user_kind" value="2101" />

		<div class="section">
			<h3 class="sectionTitle">Upline Information</h3>
			<div class="innerBox">
				<div class="tableBox">
					<label for="recomm_in">
						<div class="labelInnerBox">
							<span class="inputTitle">Enroller ID</span>
							<button type="button" id="btn_recomm_chk" class="inputBtn" onclick="upline_chk('R');">Check</button>
						</div>
					</label>
					<input type="text" name="recomm_in" id="recomm_in" placeholder="Enter Enroller ID"
						   check="T" check_type="length" check_length="0" check_key=""
     					   title="You have to check your Enroller information."
						   maxLength="30" value="<%=r_id%>">
					<span class="focus-input100"></span>
				</div>
				<div class="tableBox">
					<label>
						<div class="labelInnerBox">
							<span class="inputTitle">Enroller Name</span>
						</div>
					</label>
					<span id="exp_recomm" class="hiddenInputName"></span>
					<input type="hidden" name="recomm_id" id="recomm_id"  placeholder="Enter Enroller ID"
						   check="T" check_type="length" check_length="0" check_key=""
						   title="Please check your Enroller information.">
				</div>
				<div class="tableBox" style="background:#252525;">
					<p class="infoBox">You cannot change your upline information (Enroller ID) after signup.<br>Please be sure to check your correct upline information.</p>
				</div>
			</div>
		</div>
		<div class="section">
			<h3 class="sectionTitle">New user information</h3>
			<div class="innerBox">
				<div class="tableBox">
					<label for="country">
						<div class="labelInnerBox">
							<span class="inputTitle">Country</span>
						</div>
					</label>
					<select name="country" id="country"
							check="T" check_type="length" check_length="0" check_key=""
							title="Please select the country field.">
						<%
						sql =		"select	country, initcap(country_name) as country_name	"
						sql = sql & "  from	country						"
						sql = sql & " where	isUSE = '1'					"
						sql = sql & " order by country_name				"
						Set rs_country = DBConn.Execute(sql)

						Do While Not rs_country.Eof
							Response.Write "<option value='" & rs_country("country") & "'>" & rs_country("country_name") & "</option>"
							rs_country.MoveNext
						Loop
						rs_country.Close
						%>
					</select>
					<span class="focus-input100"></span>
				</div>
				<div class="tableBox">
					<label for="center">
						<div class="labelInnerBox">
							<span class="inputTitle">Center</span>
						</div>
					</label>
					<select name="center" id="center"
							check="T" check_type="length" check_length="0" check_key=""
							title="Please select the Center field.">
						<%
						sql =		"select	center_cd, center_name	"
						sql = sql & "  from	center					"
						sql = sql & " where	isUSE = '1'				"
						sql = sql & " order by center_cd			"
						Set rsCenter = DBConn.Execute(sql)

						Do While Not rsCenter.Eof
							Response.Write "<option value='" & rsCenter("center_cd") & "'>" & rsCenter("center_name") & "</option>"
							rsCenter.MoveNext
						Loop
						rsCenter.Close
						%>
					</select>
					<span class="focus-input100"></span>
				</div>
				<div class="tableBox">
					<label for="firstname">
						<div class="labelInnerBox">
							<span class="inputTitle">First Name</span>
						</div>
					</label>
					<input type="text" name="firstname" id="firstname" placeholder="Enter First Name"
						   check="T" check_type="length" check_length="0" check_key=""
     					   title="Please fill in the firstname field."
						   value="<%=firstname%>">
					<span class="focus-input100"></span>
				</div>
				<div class="tableBox">
					<label for="lastname">
						<div class="labelInnerBox">
							<span class="inputTitle">Last Name</span>
						</div>
					</label>
					<input type="text" name="lastname" id="lastname" placeholder="Enter Last Name"
						   check="T" check_type="length" check_length="0" check_key=""
     					   title="Please fill in the lastname field."
						   value="<%=lastname%>">
					<span class="focus-input100"></span>
				</div>
				<div class="tableBox">
					<label for="exp_id">
						<div class="labelInnerBox">
							<span class="inputTitle">Login ID</span>
							<button type="button" id="id_chk_btn" class="inputBtn" onclick="login_id_chk();">Check</button>
							<button type="button" id="id_chk_reset" class="inputBtn reset" onclick="login_id_reset();" style="display:none;">Reset</button>
						</div>
					</label>
					<input type="text" name="exp_id" id="exp_id" placeholder="Enter Login ID"
						   check="T" check_type="length" check_length="0" check_key=""
     					   title="Please fill in the Login ID field."
						   maxLength="12">
					<span class="focus-input100"></span>
					<input	type="hidden" name="dupl_chk" id="dupl_chk"
							check="T" check_type="value" check_length="0" check_key="T"
							title="Please fill in the Login ID field.">
				</div>
				<div class="tableBox">
					<label for="passwd">
						<div class="labelInnerBox">
							<span class="inputTitle">Password</span>
						</div>
					</label>
					<input type="password" name="passwd" id="passwd" placeholder="Enter Password"
						   check="T" check_type="length" check_length="3" check_key=""
     					   title="Please fill in the password field more than 4 characters."
						   maxLength="30">
					<span class="focus-input100"></span>
				</div>
				<div class="tableBox">
					<label for="passwd_re">
						<div class="labelInnerBox">
							<span class="inputTitle">Confirm Password</span>
						</div>
					</label>
					<input type="password" name="passwd_re" id="passwd_re" placeholder="Enter Confirm Password"
						   check="T" check_type="length" check_length="3" check_key=""
     					   title="Please check your password."
						   maxLength="30">
					<span class="focus-input100"></span>
				</div>
				<div class="tableBox">
					<label for="mobile">
						<div class="labelInnerBox">
							<span class="inputTitle">Mobile Phone</span>
						</div>
					</label>
					<input type="text" name="mobile" id="mobile" placeholder="Enter Mobile Phone"
						   check="T" check_type="length" check_length="0" check_key=""
     					   title="Please fill in the mobile phone field."
						   maxLength="20">
					<span class="focus-input100"></span>
				</div>
				<div class="tableBox">
					<label for="email">
						<div class="labelInnerBox">
							<span class="inputTitle">E-Mail</span>
						</div>
					</label>
					<input type="text" name="email" id="email" placeholder="Enter E-Mail"
						   check="T" check_type="length" check_length="0" check_key=""
     					   title="Please fill in the E-Mail field."
						   maxLength="100">
					<span class="focus-input100"></span>
				</div>
			</div>
		</div>
		<div class="section">
			<div class="innerBox btnWrap">
				<button type="button" class="btnDefault" style="background:#8666b2;" id="btnSend">Signup</button>
				<button type="button" class="btnDefault" style="background:#313133;" onClick="location.href='/myoffice/order/order_history.html';">Cancel</button>
			</div>
		</div>
		</form>
	</div>
</div>

<!-- #include virtual = "/myoffice/inc/footer.html" -->
<script>
$(document).ready(function() {
	$('#exp_id').keyup(function() {
		$(this).val( $(this).val().replace( /[ㄱ-ㅎ| |ㅏ-ㅣ|가-힣]/g, '' ) );
	});
});

$("#btnSend").on("click", function(){
	var proc_ok = "T";

	if(validateEmail($("#email").val()) != true){
		alert("Please check your E-Mail.");
		$("#email").focus();
		return false
	}

	if (!$("#reg_frm").validation()){
		proc_ok = "F";
		return false;
	}

	if ($("#passwd").val() != $("#passwd_re").val()) {
		alert("Please check your password.");
		$("#passwd_re").focus();
		proc_ok = "F";
		return false;
	}

	if (proc_ok == "T")	{
		ajaxSendSignup();
	}
});

function ajaxSendSignup(){
	var url = "/myoffice/common/signup_proc.html";
	var data = $("#reg_frm").serializeObject();

	$.ajax({
		url : url,
		global :false,
		contentType : "application/x-www-form-urlencoded; charset=euc-kr",
		type : "POST",
		data : data,
		dataType: 'text',
		crossDomain: true,
		async:false,
		success:function(rtnData){
			var arrItem = rtnData.split("|");
			var rtnState= arrItem[0];
			var rtnMsg 	= arrItem[1].replace(/\\n/g, '\n');
			var	rtnUrl 	= arrItem[2];

			if (rtnState == "SUCCESS") {
				alert(rtnMsg);
				location.reload();
			} else {
				alert(rtnMsg);
			}
		},
		error:function(reponse,textStatus,errorThrown){
			alert("Sorry!!! Some errors are occurred.\n\nPlease try again later.\n\nThank you.");
		},
		beforeSend:function(){
		}
	});
}

function login_id_chk() {
	var $id_chk_btn		= $("#id_chk_btn");
	var $id_chk_reset	= $("#id_chk_reset");
	var $exp_id			= $("#exp_id");
	var $dupl_chk		= $("#dupl_chk");
	var $exp_id			= $("#exp_id");

	if ($("#exp_id").val().length < 4) {
		alert("LOGIN ID have to be more than 4 characters");
		$("#exp_id").focus();
	} else {
		var ajax_url = "/myoffice/common/duplication_chk.html?check_val=" + $exp_id.val();
		$.ajax(ajax_url, {
			success:function(data) {

				arrResult = data.split("|");

				if (arrResult[0] == "SUCCESS") {
					if(confirm(arrResult[1].replace(/\\n/g, '\n'))) {
						$id_chk_btn.hide();
						$id_chk_reset.show();
						$exp_id.attr("readonly", true);
						$dupl_chk.val("T");
					} else {
						$id_chk_btn.show();
						$exp_id.removeAttr("readonly");
						$dupl_chk.val("");
						$exp_id.val("");
					}
					return;
				} else {
					alert(arrResult[1].replace(/\\n/g, '\n'));
					$id_chk_btn.show();
					$exp_id.removeAttr("readonly");
					$dupl_chk.val("");
					$exp_id.val("");
					return;
				}
			}
		});
	}
}

function login_id_reset() {

	var $id_chk_btn		= $("#id_chk_btn");
	var $id_chk_reset	= $("#id_chk_reset");
	var $exp_id			= $("#exp_id");
	var $dupl_chk		= $("#dupl_chk");
	var $exp_id			= $("#exp_id");

	$id_chk_btn.show();
	$id_chk_reset.hide();
	$exp_id.removeAttr("readonly");
	$exp_id.focus();
	$dupl_chk.val("");
}

function upline_chk(fKIND) {
	if (fKIND == "P") {
		var check_val = $("#parents_in").val();
	} else if (fKIND == "R") {
		var check_val = $("#recomm_in").val();
	}

	if (check_val == "") {
		alert("You have to input exact your sponsor information.");
		if		(fKIND == "P") {$("#parents_in").focus();}
		else if (fKIND == "R") {$("#recomm_in").focus(); }
	} else {
		var ajax_url = "/myoffice/common/sponsor_chk.html?check_kind=" + fKIND + "&check_val=" + check_val;

		$.ajax(ajax_url, {
			success:function(data) {

				arrResult = data.split("|");

				if (arrResult[0] == "SUCCESS") {
					// alert(arrResult[1].replace(/\\n/g, '\n'));
					if (fKIND == "R"){
						objName = "recomm";
					} else if (fKIND == "P") {
						objName = "parents";
					}
					$("#" + objName + "_id").val(arrResult[2]);
					$("#exp_" + objName).text(arrResult[3]).css("color", "");
				} else {
					if (fKIND == "R"){
						objName = "recomm";
					} else if (fKIND == "P") {
						objName = "parents";
					}
					$("#exp_" + objName).text(arrResult[1]).css("color", "red");
					return;
				}
			}
		});
	}
}

history.replaceState(null, "signup", "/myoffice/profile/signup.html");
</script>