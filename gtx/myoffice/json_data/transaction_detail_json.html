<%@ CodePage="65001" Language="vbscript"%>
<!--#include virtual="/myoffice/common/common.inc"-->
<!--#include virtual="/myoffice/common/jsonObject.class.asp"-->
<%
On Error Resume Next
userid		= Request("userid")		: If userid = "" Then userid = Session("userid")
st_date		= Request("st_date")
ed_date		= Request("ed_date")

' where
If userid <> "" Then
	strWhere = strWhere & "   and	a.userid = '" & userid & "'	"
End If
If st_date <> "" Then
	strWhere = strWhere & "   and	a.order_date >= '" & st_date & "'	"
End If
If ed_date <> "" Then
	strWhere = strWhere & "   and	a.order_date <= '" & ed_date & "'	"
End If

' // where

	sql =		"select	a.idx, a.inout_kind, a.tot_amt,											"
	sql = sql & "		NVL(a.send_userid,'-') as send_userid,									"
	sql = sql & "		NVL(e.login_id,'-') as send_id,											"
	sql = sql & "		NVL(a.rcv_userid,'-') as rcv_userid,									"
	sql = sql & "		NVL(f.login_id,'-') as rcv_id,											"
	sql = sql & "		b.code_name as cyber_kinds, a.money_kind,								"
	sql = sql & "		c.code_name as money_kinds,												"
	sql = sql & "		NVL(d.pay_name,'-') as pay_name,										"
	sql = sql & "		TO_CHAR(a.work_date,'YYYY-MM-DD HH24:MI:SS') as work_date				"
	sql = sql & "  from	cyber_wallet a, basic_code b, basic_code c, pay_name d, dist e, dist f	"
	sql = sql & " where	a.cyber_kind = b.code													"
	sql = sql & "   and	a.money_kind = c.code													"
	sql = sql & "   and	a.pay_no = d.reg_no(+)													"
	sql = sql & "   and	a.send_userid = e.userid(+)												"
	sql = sql & "   and	a.rcv_userid = f.userid(+)												"
	sql = sql & "   and	a.userid = '" & userid & "'												"
	sql = sql &	"   and	a.avail_date between '" & st_date & "' and '" & ed_date & "'			"
	sql = sql & " order by idx desc																"

	Set rs = Server.CreateObject("ADODB.RecordSet")
	rs.cursortype = 3
	rs.Open sql, DBConn

	Set JSONParse = New JSONobject
	Set JSONarr = New JSONarray
    While Not rs.EOF And rs.RecordCount > 0
		Set JSON = New JSONobject

		tran_time	= rs("work_date")
		money_kind	= rs("money_kind")
		money_kinds	= rs("money_kinds")
		cyber_kinds	= rs("cyber_kinds")
		amounts		= CCur(rs("tot_amt"))

		Select Case cyber_kind
		Case "BONUS"
			desc	= rs("pay_name")
		Case "TRANSFER"
			If rs("send_userid") <> "-" Then
				desc= "Trasfer from " & rs("send_id")
			ElseIf rs("rcv_userid") <> "-" Then
				desc= "Trasfer to " & rs("rcv_id")
			End If
		Case Else
			desc	= "&nbsp;"
		End Select

		If amounts < 0 Then
			txt_color = "color:red;"
		Else
			txt_color = "color:black;"
		End If

		If cnt Mod 2 = 0 Then
			td_color = "background:#f0f0f0;"
		Else
			td_color = "background:#fff;"
		End If

		JSON.Add "tran_time",	tran_time
		JSON.Add "money_kind",   money_kind
		JSON.Add "money_kinds",   money_kinds
		JSON.Add "cyber_kinds",   cyber_kinds
		JSON.Add "amounts",		amounts
		JSON.Add "desc",		desc


		JSONarr.Push JSON
	    rs.MoveNext
    Wend

	JSONParse.Add "list" ,JSONarr
	JSONParse.Write()

rs.Close		: Set rs = Nothing
DBConn.Close	: Set DBConn = Nothing
%>