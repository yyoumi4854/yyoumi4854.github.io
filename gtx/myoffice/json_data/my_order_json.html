<%@ CodePage="65001" Language="vbscript"%>
<!--#include virtual="/myoffice/common/common.inc"-->
<!--#include virtual="/myoffice/common/jsonObject.class.asp"-->
<%
'On Error Resume Next
userid		= Request("userid")		: If userid = "" Then userid = Session("userid")
st_date		= Request("st_date")
ed_date		= Request("ed_date")

' where
If userid <> "" Then
	strWhere = strWhere & "   and	a.userid = '" & userid & "'	"
End If
If st_date <> "" Then
	strWhere = strWhere & "   and	a.order_date >= '" & st_date & "'	"
End If
If ed_date <> "" Then
	strWhere = strWhere & "   and	a.order_date <= '" & ed_date & "'	"
End If

' // where

	sql =		"select	a.order_no, a.order_date, a.tot_amt, b.code_name,													"
	sql = sql & "		a.point_amt, a.bank_amt, a.usd_amt,																	"
	sql = sql & "		Decode(a.order_type,'1','Order','2','Return','3','Exchange','4','Cancelled') as order_type,			"
	sql = sql & "		Decode(a.order_state,																				"
	sql = sql & "			'0','Payment required',																			"
	sql = sql & "			'1','Payment complete',																			"
	sql = sql & "			'3','Ready for shipping',																		"
	sql = sql & "			'4','Shipped') as order_state,																	"
	sql = sql & "		NVL(a.gt_cd,'-') as gt_cd, a.tot_pv1,																"
	sql = sql & "		NVL(AES.DEC(d.bank_acc),'-') as bank_acc, c.pay_kind,												"
	sql = sql & "		c.tran_no,																							"
	sql = sql & "		fSTOCK_STATE(a.order_no) as stock_state																"
	sql = sql & "  from	order_head a, basic_code b, order_pay c, order_pay_tran d											"
	sql = sql & " where	a.order_kind = b.code																				"
	sql = sql & "   and	a.order_no = c.order_no(+)																			"
	sql = sql & "   and	c.order_seq = d.order_seq(+)																		"
	sql = sql & "   and	a.userid = '" & userid	& "'																		"
	sql = sql & "   and	a.order_type <> '4'																					"
	'sql = sql & "   and	a.ischeck =  '1'																					"
	sql = sql & strWhere
	sql = sql & "order by a.order_no desc																					"

'	sql = sql & strWhere
'	sql = sql & " order by " & sidx & " " & sord

	Set rs = Server.CreateObject("ADODB.RecordSet")
	rs.cursortype = 3
	rs.Open sql, DBConn

	Set JSONParse = New JSONobject
	Set JSONarr = New JSONarray
    While Not rs.EOF
		Set JSON = New JSONobject

		stock_temp	= Split(rs("stock_state"),"|")
		deli_state	= stock_temp(0)
		deli_date	= stock_temp(1)
		deli_no		= stock_temp(2)

		JSON.Add "order_type",  rs("order_type")
		JSON.Add "order_no",    rs("order_no")
		JSON.Add "order_date",	rs("order_date")
		JSON.Add "tot_amt",	    rs("tot_amt")
		JSON.Add "pay_kind",	rs("pay_kind")
		JSON.Add "usd_amt",		rs("usd_amt")
		JSON.Add "bank_amt",	rs("bank_amt")
		JSON.Add "point_amt",	rs("point_amt")
		JSON.Add "bank_acc",	rs("bank_acc")
		JSON.Add "order_state",	rs("order_state")
		JSON.Add "tran_no",		rs("tran_no")

		JSONarr.Push JSON
	    rs.MoveNext
    Wend

	JSONParse.Add "list" ,JSONarr
	JSONParse.Write()

rs.Close		: Set rs = Nothing
DBConn.Close	: Set DBConn = Nothing
%>