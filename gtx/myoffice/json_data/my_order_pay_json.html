<%@ CodePage="65001" Language="vbscript"%>
<!--#include virtual="/myoffice/common/common.inc"-->
<!--#include virtual="/myoffice/common/jsonObject.class.asp"-->
<%
order_no	= Request("order_no")
' where

' // where

	sql =		"select	b.pay_kind, b.pay_state,									"
	sql = sql &	"		b.pay_amt, b.work_date, c.bank_name,						"
	sql = sql &	"		AES.DEC(c.bank_acc) as bank_acc								"
	sql = sql & "  from	order_head a, order_pay b, order_pay_tran c					"
	sql = sql & " where	a.order_no = b.order_no										"
	sql = sql & "   and b.order_seq = c.order_seq									"
	sql = sql & "   and a.order_no = '" & order_no & "'								"

	Set rs = Server.CreateObject("ADODB.RecordSet")
	rs.cursortype = 3
	rs.Open sql, DBConn

    Set JSONParse = New JSONobject
	Set JSONarr = New JSONarray

    While Not rs.EOF

		pay_kind	= rs("pay_kind")
		pay_name	= pay_kind
		pay_state	= rs("pay_state")
		pay_amt		= rs("pay_amt")
		bank_name	= rs("bank_name")
		bank_acc	= rs("bank_acc")
		work_date	= FormatDateTime(rs("work_date"),0)

		If pay_state = "W" Then
			pay_states = "Payment required"
		ElseIf pay_state = "C" Then
			pay_states = "Payment complete"
		Else
			pay_state = "Cancelled"
		End If

		Set JSON = New JSONobject

		JSON.Add "pay_name",  	pay_name
		JSON.Add "pay_state",  	pay_state
		JSON.Add "pay_states", 	pay_states
		JSON.Add "pay_amt",		pay_amt
		JSON.Add "bank_info",	bank_acc & " / " & bank_name
		JSON.Add "work_date",	work_date
		JSON.Add "order_no",	order_no
		JSON.Add "pay_kind",	pay_kind

		JSONarr.Push JSON
	    rs.MoveNext
    Wend

    JSONParse.Add "list" ,JSONarr
	JSONParse.Write()

rs.Close		: Set rs = Nothing
DBConn.Close	: Set DBConn = Nothing
%>