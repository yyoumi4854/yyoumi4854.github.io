<!-- #include virtual="/myoffice/common/common.inc" -->
<!-- #include virtual="/myoffice/common/jsonObject.class.asp"-->
<%
'On Error Resume Next

work_user	= "WEB"

page		= Request("page") 		: If page = "" Then page = 0				'// get the requested page
pageSize	= Request("pageSize")	: If pageSize = "" Then pageSize = 10		'// get how many rows we want to have into the grid

cate_cd1	= Trim(Request.Form("cate_cd1"))
kind_cd		= Request.Form("kind_cd")


If cate_cd1 <> "" Then
	addSQL = addSQL & " and a.cate_cd1 = '" & cate_cd1 & "' "
End If
If kind_cd <> "" Then
	addSQL = addSQL & " and a.kind_cd = '" & kind_cd & "' "
End If


sql = 		"select x.* from (																				"
sql = sql & "	select a.product_cd, a.product_name, c.webinfo_cd, c.img_thumnail, c.WEBINFO_NAME, a.isWeb,	"
sql = sql & "		   c.img_s, c.img_m, c.img_l, c.work_date, c.pdt_volume, c.view_new, d.cate_name,		"
sql = sql & "		   b.amt, b.retail_amt, b.pv1, a.model_name												"
sql = sql & "	  From product a, pdt_webinfo c, product_detail b, pdt_cate1 d								"
sql = sql & "	 where	c.product_cd = a.product_cd(+)														"
sql = sql & "	   And c.product_cd = b.product_cd(+)														"
sql = sql & "	   And a.cate_cd1 = d.cate_cd1(+)															"
sql = sql & "	   And a.isuse= '1'																			"
sql = sql & "	   And a.isweb= '1'																			"
sql = sql & addSQL
sql = sql & "	 order by sort_no asc																		"
sql = sql & "	) x																							"
If is_end <> "" Then
	sql = sql & " where x.is_end = '" & is_end & "' "
End If
Set rs = Server.CreateObject("ADODB.RecordSet")
rs.cursortype = 3
rs.Open sql, DBConn

If CInt(pageSize) <> 0 Then
	rs.PageSize	= pageSize

	Set JSON = New JSONobject
    JSON.Add "currentPage", page
    JSON.Add "pageSize", pageSize
    JSON.Add "totalElements", rs.RecordCount
    JSON.Add "totalPages", rs.PageCount

	If Not rs.EOF And Not rs.BOF Then
		rs.AbsolutePage = page + 1
	End If

	Rcount = pageSize
Else
	Rcount = rs.RecordCount
End If

If Not rs.EOF And Not rs.BOF Then
	set JSONitems = New JSONarray
	While Not rs.EOF And Not rs.BOF And Rcount > 0
		Set JSONitem = New JSONobject
		For Each col In rs.Fields
			If LCase(col.Name) <> "srch_key" Then
				JSONitem.Add LCase(col.Name), col.Value
			End If
		Next
		JSONitems.Push JSONitem
		Set JSONitem = Nothing
		Rcount = Rcount - 1
		rs.MoveNext
	Wend

	rtn_state 	= "SUCCESS"
	rtn_msg 	= "사용가능 합니다."
Else
	rtn_state 	= "FAIL"
	rtn_msg 	= "데이터가 없습니다."
End If

Set JSONParse = New JSONobject

JSONParse.Add "page", JSON
JSONParse.Add "list", JSONitems
JSONParse.Write()

Set JSONParse = Nothing
Set JSONarr = Nothing
Set JSON = Nothing
rs.Close		: Set rs = Nothing
%>