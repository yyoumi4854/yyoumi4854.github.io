<!--#include virtual="/myoffice/common/db_connect.inc"-->
<!--#include virtual="/myoffice/common/function.inc"-->
<!--#include virtual="/myoffice/common/jsonObject.class.asp"-->
<!--#include virtual="/myoffice/common/freeaspupload.html" -->

<%
'Option Explicit

idx = request("idx")

If idx <> "" Then
	fn_del_web_file(idx)

End If


Dim msg

If Err.Number = 0 Then
	rtn_msg = ""
	rtn_msg = msg & "삭제 완료"
	rtn_state = "success"
Else
	rtn_msg = Err.Description '""
	rtn_msg = msg & "!!! 삭제 실패 !!!"
	rtn_state = "failure"
End If

Set jsonResult = New JSONobject
jsonResult.add "rtn_msg" ,rtn_msg
jsonResult.add "rtn_state" ,rtn_state


jsonResult.Write()

Function fn_del_web_file(idx)
	Set rs = Server.CreateObject("ADODB.RecordSet")
		sql =		"select * From WEB_FILE where idx = '"&idx&"'"
		rs.Open sql, DBConn
		If Not(rs.eof Or rs.bof) Then

			'파일이 있으면 지운다.
			Set fs=Server.CreateObject("Scripting.FileSystemObject")
			serverFilePath =Server.MapPath(rs("file_path"))
			if fs.FileExists(serverFilePath) then
			  fs.DeleteFile(serverFilePath)
			end if
			set fs=Nothing

			'DB에서 해당 정보를 삭제 한다.
			sql =		" delete from WEB_FILE	"
			sql = sql & " where idx = '" & idx & "'	"
			DBConn.Execute(sql)


		End If
		rs.Close		: Set rs = Nothing
End Function
%>