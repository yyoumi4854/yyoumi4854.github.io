<!--#include virtual="/myoffice/common/db_connect.inc"-->
<!--#include virtual="/myoffice/common/function.inc"-->
<!--#include virtual="/myoffice/common/jsonObject.class.asp"-->
<%
'Option Explicit
'넘어온 모든 Request를 자동으로 변수화
autoBindRequestToVar()

header_id = "MALL_WEB_FILE"
If page = "" Then page = 1			'// get the requested page
If rows = "" Then rows = 10		'// get how many rows we want to have into the grid


' // where
If idxs <> "" Then
strWhere = strWhere & "  and a.idx   in (" & idxs & ")	"
End If
'==============================헤더 데이터 정의=====================================


Dim headerArry(),headerGridArry()
Dim table_name,key_col_name
Set headListJson = New JSONarray '리스트 작업 진행할 것
Set dataListJson = New JSONarray '리스트 작업 진행할 것
table_name =""
key_col_name =""

	' 컬럼 헤더 정보를 불러옴
	'table_name '조회할 테이블명
	'key_col_name 'order by에 쓰일 키 컬럼
	'headerArry  '조회할 테이블에 컬럼 목록
	Call getHeaderInfo(header_id,headerArry,headListJson,table_name,key_col_name)



'전체 카운트 select 부분
	cntSql =		  " select count(*) "

	'조회용 select 부분
	colSql =		   "	select															"
	colSql = colSql & "		 a.*			"

	'from 이후 조건 부분
	bodySql =				" from WEB_FILE a         "
	bodySql = bodySql & "where 1=1 " & strWhere


	'헤더 정보로 order by 를 판단 함.
	If sidx <> ""  Then
	orderBySql = orderBySql & " order by " & sidx & " " & sord
	End if



	'전체 카운트 SQL
	totCntSql = cntSql & bodySql

	'조회 SQL
	innerSql  = colSql & bodySql & orderBySql
	'페이징용으로 변환
	pageSql = getPagingSql(page,rows,"",innerSql)
	'===================================쿼리 작성 부분 끝 ===================================


'===================================DB 쿼리 부분  ===================================
	'전체 카운트 구하기
	Set cntRs = Server.CreateObject("ADODB.RecordSet")
	'Response.Write totCntSql
	cntRs.Open totCntSql, DBConn
	If Not(cntRs.eof Or cntRs.bof) Then
		totRecord = cDbl(cntRs(0))
	End If


	'조회된 데이터 구하기
	'Response.Write pageSql
	Set objRs = Server.CreateObject("ADODB.RecordSet")
	objRs.Open pageSql, DBConn
	If Not (objRs.EOF or objRs.BOF) Then
		While Not objRs.EOF

				Set dataItem = New JSONobject
				'배열에서 헤더정보 자동 입력
				For a=0 To ubound(headerArry)
					'isClass2 Reals Pos_PS

						dataItem.add LCase(Trim(headerGridArry(a))), castNullToEmpty(objRs(Trim(headerGridArry(a))))
				Next
				dataListJson.Push dataItem
			objRs.MoveNext
		Wend
	End If


	cntRs.Close		: Set cntRs = Nothing
	objRs.Close		: Set objRs = Nothing
	DBConn.Close	: Set DBConn = Nothing
	'===================================DB 쿼리 부분 끝 ===================================

	Set jsonResult = New JSONobject
	jsonResult.add "page" ,page
	jsonResult.add "records" ,totRecord
	jsonResult.add "rows",dataListJson
	jsonResult.add "total" ,round(totRecord/rows)
	jsonResult.add "userdata",dataItem

	'화면 표시
	Response.WRite jsonResult.Serialize()
%>

