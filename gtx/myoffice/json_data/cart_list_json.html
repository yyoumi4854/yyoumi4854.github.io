<!--#include virtual="/myoffice/common/db_connect.inc"-->
<!-- #include virtual="/myoffice/common/jsonObject.class.asp"-->
<%
'Option Explicit
order_kind	= Request("order_kind")		: If order_kind = "" Then order_kind = "4101"


' where

' // where

	sql =		"select	a.reg_no, a.product, a.qty, a.pdt_option, b.product_name, b.model_name,		"
	sql = sql &	"		d.img_l, c.amt, c.amt, c.pv1, c.pv2, a.buy_kind, e.code_name,d.img_thumnail	"
	sql = sql &	"  from web_Cart a, product b, product_detail c, pdt_webinfo d,						"
	sql = sql & "		basic_code e																"
	sql = sql &	" where	a.product = b.product_cd													"
	sql = sql &	"   and	a.product = c.product_cd													"
	sql = sql &	"   and	a.product = d.product_cd(+)													"
	sql = sql & "   and	a.order_kind = e.code														"
	sql = sql &	"   and	c.reg_date = (select max(reg_date)											"
	sql = sql &	"   					from product_detail											"
	sql = sql &	"                      where product_cd = a.product)								"
	sql = sql &	"   and	a.userid = '" & Session("userid") & "'										"
	sql = sql &	"   and	a.order_kind = '" & order_kind & "'											"
	sql = sql &	" order by a.work_date desc															"

	Set rs = Server.CreateObject("ADODB.RecordSet")
	rs.cursortype = 3
	rs.Open sql, DBConn


	Set jsonItems = New JSONarray

    While Not rs.EOF

		reg_no		= rs("reg_no")
		prod_cd		= rs("product")
		product_cd	= prod_cd

		prod_name	= rs("product_name")
		prod_model	= rs("model_name")
		prod_option	= rs("pdt_option")
		prod_amt	= rs("amt")
		prod_pv1	= rs("pv1")
		prod_pv2	= rs("pv2")
		prod_img	= img_root_url & rs("img_l")
		prod_thumnail= img_root_url & rs("img_thumnail")

		prod_qty	= CInt(rs("qty"))
		buy_kind	= rs("buy_kind")
		order_kind	= rs("code_name")
		buy_amt		= CCur(prod_amt) * prod_qty
		buy_point	= CCur(prod_pv2) * prod_qty

		If IsNull(prod_img) Or Len(prod_img) < 3 Then
			prod_thumnail = "../bbs/upload/empty_img_small(6).jpg"
		End If

		Set jsonItem = New JSONobject

		jsonItem.Add "reg_no"			, reg_no
		jsonItem.Add "prod_cd"			, prod_cd
		jsonItem.Add "prod_name"		, prod_name
		jsonItem.Add "prod_model"		, prod_model
		jsonItem.Add "prod_option"		, prod_option
		jsonItem.Add "prod_amt"			, prod_amt
		jsonItem.Add "prod_pv1"			, prod_pv1
		jsonItem.Add "prod_pv2"			, prod_pv2
		jsonItem.Add "prod_qty"			, prod_qty
		jsonItem.Add "buy_amt"			, buy_amt
		jsonItem.Add "buy_point"		, buy_point
		jsonItem.Add "prod_img"			, prod_img
		jsonItem.Add "prod_thumnail"  	, prod_thumnail

		jsonItems.Push jsonItem

	    rs.MoveNext
    Wend

Set jsonParse = New JSONobject
jsonParse.Add "list", 	jsonItems
jsonParse.Write()

Set jsonParse = Nothing

rs.Close		: Set rs = Nothing
DBConn.Close	: Set DBConn = Nothing
%>