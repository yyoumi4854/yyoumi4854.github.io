<%@ CodePage="65001" Language="vbscript"%>
<!-- #include virtual ="/myoffice/common/common.inc" -->
<%
check_kind	= Request("check_kind")
check_val	= Request("check_val")

inj_chk		= check_injection("")

If inj_chk <> "OK" Then
	res_state	= "FAIL"
	res_id		= ""
	res_name	= ""
	res_msg		= "Some characters are not allowed. Please check your input data."
Else

	If check_kind = "R" Then
		title		= "SPONSOR"			'-------- 추천인
		exp_fld		= "exp_recomm"
		fld_name	= "recomm_id"
	ElseIf check_kind = "P" Then
		title		= "PLACEMENT"		'-------- 후원인
		exp_fld		= "exp_parents"
		fld_name	= "parents_id"
	End If

	sql =		"select	userid, username, isClass		"
	sql = sql & "  from	dist							"
	sql = sql & " where	login_id = '" & check_val & "'	"
	sql = sql & "   and	isClass = '1'					"
	sql = sql & "union all								"
	sql = sql &	"select	userid, username, isClass		"
	sql = sql & "  from	dist							"
	sql = sql & " where	login_id = '" & check_val & "'	"
	sql = sql & "   and	isClass = '1'					"
	Set rs = DBConn.Execute(sql)

	If rs.Eof Then
		res_state	= "FAIL"
		res_id		= ""
		res_name	= ""
		res_msg		= "Error : No users found"
	Else

		proc_ok = "T"

'		If check_kind = "P" Then
'
'			sql =		"select	NVL(sum(A_CNT),0) as A_CNT, NVL(sum(B_CNT),0) as B_CNT														"
'			sql = sql & "  from	(																											"
'			sql = sql & "		select	count(*) as A_CNT, 0 as B_CNT																		"
'			sql = sql & "		  from	dist																								"
'
'			If rs("userid") <> session("userid") Then
'			sql = sql & "		 where	userid = '" & rs("userid") & "'																		"
'			sql = sql & "		 start with userid = (select userid from dist where	parents_id = '" & session("userid") & "' and pos_p = 1)	"
'			sql = sql & "		 connect by parents_id = prior userid																		"
'			Else
'			sql = sql & "		 where	parents_id = '" & rs("userid") & "'																	"
'			sql = sql & "		   and	pos_p = 1																							"
'			End If
'
'			sql = sql & "		union all																									"
'			sql = sql & "		select	0 as A_CNT, count(*) as B_CNT																		"
'			sql = sql & "		  from	dist																								"
'
'			If rs("userid") <> session("userid") Then
'			sql = sql & "		 where	userid = '" & rs("userid") & "'																		"
'			sql = sql & "		 start with userid = (select userid from dist where	parents_id = '" & session("userid") & "' and pos_p = 2)	"
'			sql = sql & "		 connect by parents_id = prior userid																		"
'			Else
'			sql = sql & "		 where	parents_id = '" & rs("userid") & "'																	"
'			sql = sql & "		   and	pos_p = 2																							"
'			End If
'
'			sql = sql & "		)																											"
'			Set rs_line = DBConn.Execute(sql)
'
'			If CInt(rs_line("A_CNT")) = 0 And CInt(rs_line("B_CNT")) = 0 Then
'				proc_ok		= "F"
'				proc_msg	= "Error : Target user is not exist in your downline"
'			Else
'
'				sql =		"select	count(userid) as p_cnt				"
'				sql = sql & "  from	dist								"
'				sql = sql & " where	parents_id = '" & rs("userid") & "'	"
'				Set rs_pchk = DBConn.Execute(sql)
'					p_cnt = CInt(rs_pchk("p_cnt"))
'				rs_pchk.close : Set rs_pchk = Nothing
'
'				If p_cnt >= 2 Then
'					proc_ok		= "F"
'					proc_msg	= "Error : Placement is full"
'				Else
'
'					If CInt(rs_line("A_CNT")) > 0 Then
'						temp_line = "A"
'					Else
'						temp_line = "B"
'					End If
'
'					sql =		"select	NVL(sum(left_sum),0) as A_SUM, NVL(sum(right_sum),0) as B_SUM												"
'					sql = sql & "  from	(select	sum(tot_pv1) as left_sum, 0 as right_sum															"
'					sql = sql & "		   from	order_head																							"
'					sql = sql & "		  where	userid in (																							"
'					sql = sql & "		 select	userid																								"
'					sql = sql & "		   from	dist																								"
'					sql = sql & "		  start with userid = (select userid from dist where parents_id = '" & session("userid") & "' and pos_p = 1)"
'					sql = sql & "		  connect by parents_id = prior userid)																		"
'					sql = sql & "		union all																									"
'					sql = sql & "		 select	0 as left_sum, sum(tot_pv1) as right_sum															"
'					sql = sql & "		   from	order_head																							"
'					sql = sql & "		  where	userid in (																							"
'					sql = sql & "		 select	userid																								"
'					sql = sql & "		   from	dist																								"
'					sql = sql & "		  start with userid = (select userid from dist where parents_id = '" & session("userid") & "' and pos_p = 2)"
'					sql = sql & "		  connect by parents_id = prior userid)																		"
'					sql = sql & "		)																											"
'
'					Set rs_sum = DBConn.Execute(sql)
'
'					Select Case temp_line
'					Case "A"
'						If CCur(rs_sum("A_SUM")) >= CCur(rs_sum("B_SUM")) Then
'							target_line = "L"
'						ELSE
'							target_line = "S"
'						End If
'					Case "B"
'						If CCur(rs_sum("A_SUM")) >= CCur(rs_sum("B_SUM")) Then
'							target_line = "S"
'						ELSE
'							target_line = "L"
'						End If
'					End Select
'
'				End If
'			End If
'
'		End If

		If proc_ok = "T" Then

'			Response.Write "<script language='javascript'>"
'			Response.Write "	parent.document.getElementById('" & fld_name & "').value	 = '" & rs("userid") & "';"
'			Response.Write "	parent.document.getElementById('" & exp_fld	 & "').innerText = '" & rs("username") & "';"
'
'			If check_kind = "P" Then
'				Response.Write "	parent.document.getElementById('position').value		 = '" & target_line & "';"
''				Response.Write "	alert('" & target_line & "');"
'			End If
'
'			Response.Write "</script>"
'			Response.End

			res_state	= "SUCCESS"
			res_id		= rs("userid")
			res_name	= rs("username")
			res_msg		= ""

		Else

'			Response.Write "<script language='javascript'>"
'			Response.Write "	parent.document.getElementById('" & fld_name & "').value	 = '';"
'			Response.Write "	parent.document.getElementById('" & exp_fld	 & "').innerText = '" & proc_msg & "';"
'
'			If check_kind = "P" Then
'				Response.Write "	parent.document.getElementById('position').value			 = '';"
'	'			Response.Write "	alert('" & target_line & "');"
'			End If
'
'			Response.Write "</script>"
'			Response.End

			res_state	= "FAIL"
			res_id		= ""
			res_name	= rs("username")
			res_msg		= proc_msg

		End If

	End If


End If
Response.Write res_state & "|" & res_msg & "|" & res_id & "|" & res_name
%>
<!--#include virtual="/myoffice/common/db_close.inc"-->