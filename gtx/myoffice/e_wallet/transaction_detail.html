<%@ CodePage="65001" Language="vbscript"%>
<!-- #include virtual = "/myoffice/common/common.inc" -->
<!-- #include virtual = "/myoffice/inc/head.html" -->

<!-- #include virtual = "/myoffice/inc/header.html" -->

<!-- #include virtual = "/myoffice/inc/nav.html" -->
<%
Call Check_Login(fURL)

s_date	 = Request("s_date")		: If s_date = "" Then s_date = CStr(DateAdd("ww",-1,Date))
e_date	 = Request("e_date")		: If e_date	= "" Then e_date = CStr(Date)
que_check= Request("que_check")		: que_check = "T"
%>
<style>
	.num_right {text-align:right !important;}
</style>
<div id="container">
	<div class="contentHeader">
		<h3 class="contentTitle"><i class="fa fa-th-large" aria-hidden="true"></i> Transaction Detail</h3>
	</div>
	<div class="content">
		<div class="section">
			<h3 class="sectionTitle">Money Balance</h3>
			<div class="innerBox" style="padding:10px;">
				<table class="walletTable" style="width:100%">
					<thead>
						<tr>
							<th>Money Kind</th>
							<th>GTXp Point</th>
						</tr>
					</thead>
					<tr>
						<td>Total</td>
						<td><span id="tot_GTXp">0</span> GTXp</td>
					</tr>
				</table>
			</div>
		</div>
		<div class="section">
			<h3 class="sectionTitle">Report period</h3>
			<div class="innerBox">
				<form>
					<div class="searchBox">
						<div class="searchInner">
							<input type="text" name="st_date" id="st_date" class="inputFromDate" value="<%=s_date%>">
							<input type="text" name="ed_date" id="ed_date" class="inputToDate" value="<%=e_date%>">
							<button type="button" class="btnSearch" id="btnSearch"><i class="fa fa-search" aria-hidden="true"></i> INQUIRY</button>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div class="section">
			<div class="innerBox" style="padding:10px;">
				<table id="dataTable" class="display nowrap" style="width:100%">
					<thead>
						<tr>
							<th>Date</th>
							<th>Money</th>
							<th>Action</th>
							<th>Amounts</th>
							<th>Description</th>
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>
</div>

<!-- #include virtual = "/myoffice/inc/footer.html" -->

<script type="text/javascript">
	$(function(){
		amt_check();

		$("#st_date").datepicker({
			dateFormat: "yy-mm-dd"
		});
		$("#ed_date").datepicker({
			dateFormat: "yy-mm-dd"
		});

		var $tblOrder = $("#dataTable").DataTable({
				scrollX : true,
				searching : false,
				lengthChange : false,
				ajax: {
					url: "/myoffice/json_data/transaction_detail_json.html",
					dataSrc: "list",
					type: "POST",
					data : function (d){
						d.st_date		= $("#st_date").val();
						d.ed_date		= $("#ed_date").val();
						d.userid		= "<%=Session("userid")%>";
					}
				},
				columns: [
					{ data: "tran_time" },
					{ data: "money_kinds" },
					{ data: "cyber_kinds" },
					{ data: "amounts" },
					{ data: "desc" }
				],
				columnDefs: [
					{
						targets : [3],
						className : "num_right",
						render : function(data, type, row){
							rtnData = numeral(data).format("0,0");
							return rtnData;
						}
					},
					{
						targets : [0],
						render : function(data, type, row){
//							rtnData = formatDate(data);
							rtnData = data;
							return rtnData;
						}
					}
				],
				order: [[0, "desc"]],
				pagingType : "numbers"
			});

		$("#btnSearch").on("click", function(){
			$tblOrder.ajax.reload();
		});
	});

	function set_date(fTERM) {

		var url_ = "/myoffice/common/date_cal.html?term="+fTERM;
		$.ajax(url_,{
			success:function(data) {
				var ret_str = data.split('|');
				if (ret_str[0] == "SUCCESS")     {
					$("#s_date").val(ret_str[1]);
					$("#e_date").val(ret_str[2]);
				} else {
					$("#s_date").val(ret_str[1]);
					$("#e_date").val(ret_str[2]);
				}
			}
		});
	}

	function amt_check() { window.ref = window.setInterval(function() { get_amt(); }, 500); }

	function get_amt() {
		clearInterval(window.ref);
		$.ajax('/myoffice/common/get_money.html',{
			success:function(data){
				var amt_temp = data.split("|");
				var tot_GTXp	 = amt_temp[0];

				$("#tot_GTXp").text(formatComma(tot_GTXp, 0));
			}
		});

		amt_check();
	}
</script>