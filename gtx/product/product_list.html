<!-- #include virtual = /inc/head.html -->
<!-- #include virtual = "/inc/header.html" -->
<%
cate_cd1 = Request("cate_cd1")
%>
<div class="skincare">
  <div class="title">
    <h2 id="h2Title">&nbsp;</h2>
  </div>
  <div class="pro_select">
    <div class="inner">
      <select class="" name="subMenuCateCd" id="subMenuCateCd" onchange="fnGoUrl(this.value);">
        <option value="">ALL PRODUCTS</option>
        <%
        For i = 1 To UBound(menuCateCd)
          Response.Write "<option value=""" & menuCateCd(i) & """>" & menuCateName(i) & "</option>"
        Next
        %>
      </select>
      <script>
        $(function(){
          $('#subMenuCateCd').val('<%=cate_cd1%>');
          $("#h2Title, #h3Title").text($("#subMenuCateCd option:checked").text());
        });
        function fnGoUrl(_value) {
          location.href = "./product_list.html?cate_cd1=" + _value;
        }
      </script>
      <!-- <select name="speed" id="speed">
      <option>ALL PRODUCTS</option>
      <option>NATURAL SOAP</option>
      <option selected="selected">SKIN CARE</option>
      <option>HAIR CARE</option>
    </select> -->
  </div>
</div>
<div class="skin_con">
  <div class="inner">
    <div class="tit_h3">
      <h3><span id="h3Title">NATURAL SOAP</span> (<span id="h3Cnt">0</span>)</h3>
    </div>
    <ul class="pro_list"></ul>

    <div class="empty">
      <p>There is no registered product.</p>
    </div>

    <div class="paging"></div>
  </div>
  <div class="popup">
    <div class="popup_con">
      <div class="top">
        <img src="../img/skincare/skin_pro_01.jpg" alt="" id="popImg">
        <div class="txt_wrap">
          <div class="top">
            <p>
              <span id="spnName">Belopvs Sparkling Soap</span>
              <span id="spnModel">(Babassu Oil)</span>
            </p>

            <p>
              <span>$<label id="spnAmt">20.00</label></span>
              <span>QTY : <label id="spnQty">1</label></span>
            </p>
          </div>
          <div class="bottom">
            <p>TOTAL <span id="spnTot">40.00</span></p>
            <p>ITEMS IN YOUR BAG : <span id="spnBag">5</span></p>
          </div>
        </div>
      </div>
      <div class="bottom">
        <a href="#" onclick="fnCartPopup('hide');">CONTINUE SHOPPING</a>
        <a href="/shop/shoppingbag.html">VIEW SHOPPING BAG</a>
      </div>
      <a href="#" class="close">close</a>
    </div>
  </div>
</div>
</div>
<script>
  $(function(){
    // $( "#speed" ).selectmenu();

    $(".skin_con ul li .list .pay_wrap a:nth-child(1)").click(function(e){
      e.preventDefault();
      $(".popup").fadeIn();
    });

    $(".popup .popup_con .close").click(function(e){
      e.preventDefault();
      $(".popup").fadeOut();
    });

    fnGoPage(1);
  });

  function fnCartPopup(_action, _item) {
    event.preventDefault();
    if (_action == 'show'){
      var totAmt = 0;
      totAmt = Number(_item.amt) * Number(_item.qty);
      $("#popImg").attr('src',_item.img_l);
      $("#spnName").text(_item.product_name);
      $("#spnModel").text("(" + _item.product_model + ")");
      $("#spnAmt").text(numeral(_item.amt).format('0,0.00'));
      $("#spnQty").text(_item.qty);
      $("#spnTot").text(numeral(totAmt).format('$0,0.00'));
      $("#spnBag, .count").text(_item.bagCnt);
      $(".popup").fadeIn();
    } else {
      $(".popup").fadeOut();
    }
  }

  function fnListJson( _pageNo, _kind){
    var _pageSize	= 8;
		var _perArea	= 5;
    var _totalPages = 0;
    var $tgList = $(".pro_list");
    var url = "/myoffice/json_data/list_product_json.html";
		var data = {
				page	 : _pageNo-1,
				pageSize : _pageSize,
				cate_cd1 : '<%=cate_cd1%>'
      };

    $tgList.loading('start');
    $tgList.empty();
    $(".empty").hide();

    $.post(url, data, function(jsonData) {
				if (typeof jsonData !== 'object') {
					jsonData = JSON.parse(jsonData);
				}
				var addHtml = "";
				var bbsList = jsonData.list;
				var bbsPage = jsonData.page;

				_totalPages = bbsPage.totalElements;

          // echoNull2Blank(value.thum_img)
				$.each(bbsList, function(index, value){
          addHtml += '<li class="item">';
          addHtml += '  <div class="list">';
          addHtml += '    <a href="/product/product.html?product_cd=' + echoNull2Blank(value.product_cd) + '">';
          addHtml += '      <div class="best_pro">';
          addHtml += '        <img src="' + echoNull2Blank(value.img_l) + '" alt="">';
          addHtml += '      </div>';
          addHtml += '      <div class="txt_wrap">';
          addHtml += '        <p>Belovps Sparkling Premium Soap</p>';
          addHtml += '        <p>' + numeral(value.amt).format('$0,0.00') + '</p>';
          addHtml += '        <p>';
          addHtml += '          <span>';
          addHtml += '            <i class="fas fa-star"></i>';
          addHtml += '            <i class="fas fa-star"></i>';
          addHtml += '            <i class="fas fa-star"></i>';
          addHtml += '            <i class="fas fa-star"></i>';
          addHtml += '            <i class="fas fa-star-half-alt"></i>';
          addHtml += '          </span>';
          addHtml += '          <span>Review : 450</span>';
          addHtml += '        </p>';
          addHtml += '      </div>';
          addHtml += '    </a>';
          addHtml += '    <div class="pay_wrap">';
          addHtml += '      <a href="#" onclick="fnCart(\'' + echoNull2Blank(value.product_cd) + '\');"></a>';
          addHtml += '      <a href="#" onclick="fnOrder(\'' + echoNull2Blank(value.product_cd) + '\');"></a>';
          addHtml += '    </div>';
          addHtml += '  </div>';
          addHtml += '</li>';
				});

				$tgList.html(addHtml);

				if (_totalPages == 0) {
					$(".empty").show();
				}

        $("#h3Cnt").text(_totalPages);
				$(".paging").jqueryPager({pageSize: _pageSize,
											pageBlock: _perArea,
											currentPage: _pageNo,
											pageTotal: _totalPages,
											clickEvent: 'fnGoPage'});
    }, 'json')
		.fail(function (jqXHR, textStatus, errorThrown) {
			alert('HTTP status code: ' + jqXHR.status + '\n' +
				'textStatus: ' + textStatus + '\n' +
				'errorThrown: ' + errorThrown);
			alert('HTTP message body (jqXHR.responseText): ' + '\n' + jqXHR.responseText);
    })
    .always(function(){
      $tgList.loading('stop');
    });
  }

	function fnGoPage(n){
		var kind = "";
		fnListJson(n, kind);
  }
  
  function fnCart(_product_cd){
    event.preventDefault();
    if ("<%=Session("login_id")%>" == "") {
      alert("로그인이 필요한 서비스입니다.\n로그인 화면으로 이동합니다.");
      location.href = "/member/login.html";
      return false;
    } else {
      var work_type = 'NEW';
      var cart_no = "";
      var qty = "1";

      var url = "/myoffice/json_data/cart_insert_json.html";
      var data = {
          work_type	  : work_type,
          product_cd	: _product_cd,
          cart_no		  : cart_no,
          qty			    : qty,
          order_kind	: "4101"
        };
      $.post(url, data, function(jsonData) {
        var items = jsonData.rtnResult;
        if (items) {
          var rtn_msg = items.rtn_msg.replace(/\\n/g, '\n')
          if (items.rtn_state == "success"){
            fnCartPopup('show', jsonData.rtnProduct);
            // if (confirm(rtn_msg+"\n\n지금 장바구니를 확인하시겠습니까?")) {
            //   location.href = "/shop/shoppingbag.html";
            // }
          } else {
            if (confirm("이미 장바구니에 보관된 상품입니다.\n\n수량 변경은 장바구니에서 가능합니다.\n\n지금 장바구니를 확인하시겠습니까?")) {
              location.href = "/shop/shoppingbag.html";
            }
          }
        }
        return;
      }, 'json')
      .fail(function (jqXHR, textStatus, errorThrown) {
        alert('HTTP status code: ' + jqXHR.status + '\n' +
          'textStatus: ' + textStatus + '\n' +
          'errorThrown: ' + errorThrown);
        alert('HTTP message body (jqXHR.responseText): ' + '\n' + jqXHR.responseText);
      });
    }
  }

  function fnOrder(_product_cd){
    event.preventDefault();
    var $form = $('<form></form>');
    $form.attr('action', '/shop/checkout.html');
    $form.attr('method', 'get');
    $form.appendTo('body');

    var product_cd = $('<input type="hidden" name="product_cd" value="' + _product_cd + '" />');
    var qty = $('<input type="hidden" name="qty" value="1" />');

    $form.append(product_cd).append(qty);
    $form.submit();
  }
</script>
<!-- #include virtual = /inc/foot.html -->
